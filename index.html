<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025å“¡å·¥å¥æª¢å‰ä¸‰å¤§ç•°å¸¸æœ‰çå¾µç­”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        :root { 
            --dhl-yellow: #FFCC00;
            --dhl-red: #D40511;
            --dhl-dark-red: #B3040E;
        }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: var(--dhl-yellow); 
        }

        .dhl-red-bg { background-color: var(--dhl-red); }
        .dhl-red-text { color: var(--dhl-red); }
        
        .btn-dhl {
            background-color: var(--dhl-red);
            color: white;
            transition: all 0.3s ease;
        }
        .btn-dhl:hover {
            background-color: var(--dhl-dark-red);
            transform: translateY(-2px);
        }

        .option-btn:hover {
            border-color: var(--dhl-red);
            background-color: rgba(212, 5, 17, 0.05);
        }

        #progress-bar {
            background-color: var(--dhl-red);
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--dhl-red);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #success-overlay {
            background: rgba(0,0,0,0.8);
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- æˆåŠŸæäº¤è¦†è“‹å±¤ -->
    <div id="success-overlay" class="fixed inset-0 z-50 flex items-center justify-center p-6 text-center">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full animate__animated animate__bounceIn">
            <div id="overlay-icon" class="text-6xl mb-4">âœ…</div>
            <h3 id="overlay-title" class="text-2xl font-bold mb-2">æäº¤æˆåŠŸï¼</h3>
            <p id="overlay-msg" class="text-gray-600 mb-6">æ„Ÿè¬æ‚¨çš„åƒèˆ‡ï¼Œç¥æ‚¨ä¸­å¤§çï¼</p>
            <button onclick="location.reload()" id="overlay-btn" class="w-full btn-dhl py-3 rounded-xl font-bold">è¿”å›é¦–é </button>
        </div>
    </div>

    <!-- 1. è³‡è¨Šè¼¸å…¥é é¢ -->
    <div id="start-container" class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-8 animate__animated animate__fadeIn">
        <div class="flex justify-center mb-6">
            <div class="dhl-red-bg text-white px-6 py-2 font-black italic text-2xl tracking-tighter">HEALTH QUIZ 2025</div>
        </div>
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">å“¡å·¥å¥æª¢ç•°å¸¸æœ‰çå¾µç­”</h1>
            <p class="text-gray-500 font-medium">å¡«å¯«åƒèˆ‡è³‡æ–™ï¼Œæ»¿åˆ†å³å¯åƒåŠ æŠ½çğŸ</p>
        </div>
        <div class="space-y-6">
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">å“¡å·¥ç·¨è™Ÿ</label>
                <input type="text" id="user-id" placeholder="ä¾‹å¦‚: 012345" class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:outline-none focus:border-[#D40511] transition text-gray-800">
            </div>
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">ä¸­æ–‡å§“å</label>
                <input type="text" id="user-name" placeholder="è«‹è¼¸å…¥å®Œæ•´å§“å" class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:outline-none focus:border-[#D40511] transition text-gray-800">
            </div>
            <button onclick="startQuiz()" class="w-full btn-dhl font-bold py-4 rounded-xl shadow-lg text-lg">
                é–‹å§‹æŒ‘æˆ° GOï¼
            </button>
            <p class="text-[10px] text-gray-400 text-center uppercase tracking-widest">Internal Use Only</p>
        </div>
    </div>

    <!-- 2. æ¸¬é©—å®¹å™¨ -->
    <div id="quiz-container" class="hidden bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate__animated animate__fadeIn">
        <div class="h-2 bg-gray-100">
            <div id="progress-bar" class="h-full transition-all duration-300" style="width: 0%"></div>
        </div>
        <div class="p-8">
            <div class="flex justify-between items-center mb-6">
                <span id="question-number" class="dhl-red-text font-bold text-sm tracking-widest uppercase">Q 1 / 4</span>
                <span id="score-display" class="bg-red-100 dhl-red-text px-3 py-1 rounded-full text-xs font-bold">SCORE: 0</span>
            </div>
            <h2 id="question-text" class="text-2xl font-bold text-gray-800 mb-8 leading-tight">è¼‰å…¥ä¸­...</h2>
            <div id="options-container" class="space-y-4"></div>
        </div>
        <div id="feedback" class="hidden p-4 text-center font-bold text-white transition-all"></div>
    </div>

    <!-- 3. çµæœé é¢ -->
    <div id="result-container" class="hidden bg-white rounded-2xl shadow-2xl w-full max-w-lg p-10 text-center animate__animated animate__zoomIn">
        <div class="mb-4">
            <span id="result-emoji" class="text-6xl">ğŸ†</span>
        </div>
        <h2 id="result-title" class="text-2xl font-bold text-gray-800 mb-2">æŒ‘æˆ°å®Œæˆï¼</h2>
        
        <div class="bg-gray-50 rounded-xl py-2 px-4 mb-6 inline-block border-l-4 border-[#D40511]">
            <p class="text-gray-600 text-xs">æŒ‘æˆ°è€…ï¼š<span id="display-user-info" class="font-bold text-gray-900"></span></p>
        </div>

        <div class="mb-8">
            <p class="text-gray-500 text-sm mb-1">æ‚¨çš„å¾—åˆ†</p>
            <div class="text-6xl font-black dhl-red-text" id="final-score">0</div>
        </div>

        <button id="submit-btn" onclick="submitToSheet()" class="w-full btn-dhl font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 text-lg">
            <span id="submit-btn-text">æäº¤ä¸¦åƒåŠ æŠ½ç</span>
            <div id="submit-loader" class="loader hidden"></div>
        </button>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwRNAFaKjstuRjDiOufJfTJSFgqe0oJtm-wfARupDxtp8ZsDPe4MMi6SIYnIXXB8RSq/exec";

        const quizData = [
            { question: "ä»¥ä¸‹ä½•è€…ç‚ºè„‚è‚ªè‚é«˜é¢¨éšªå› å­ï¼Ÿ", options: ["æ”å–é«˜ç†±é‡ã€é«˜è„‚è‚ªé£Ÿç‰©", "è‚¥èƒ–é«”ä½", "éé‡é£²é…’", "ä»¥ä¸Šçš†æ˜¯"], correct: 3 },
            { question: "è«‹å•18æ­²ä»¥ä¸Šæˆäººï¼ŒBMI(èº«é«”è³ªé‡æŒ‡æ•¸)è¶…éå¤šå°‘å³æ˜¯éé‡ï¼Ÿ", options: ["18", "20", "22", "24"], correct: 3 },
            { question: "å¥³æ€§é«”è„‚ç‡æª¢æ¸¬çµæœç‚º 31.1ï¼Œè«‹å•é«”è„‚æ˜¯å¦åœ¨å¥åº·ç†æƒ³ç¯„åœï¼Ÿ", options: ["æ˜¯", "å¦"], correct: 1 },
            { question: "ä»¥ä¸‹ä½•è€…ä¸èƒ½æ”¹å–„è„‚è‚ªè‚ã€BMIéé«˜ã€é«”è„‚ç‡éé«˜çš„å•é¡Œï¼Ÿ", options: ["å‡è¡¡é£²é£Ÿ", "ç¶“å¸¸å–å«ç³–é£²æ–™", "è¦å¾‹é‹å‹•", "æˆ’è¸"], correct: 1 },
        ];

        let currentQuestion = 0, score = 0, canAnswer = true;
        let userData = { id: "", name: "" };

        function startQuiz() {
            const id = document.getElementById('user-id').value.trim();
            const name = document.getElementById('user-name').value.trim();
            if (!id || !name) { alert("è«‹å¡«å¯«å“¡å·¥ç·¨è™Ÿèˆ‡å§“åï¼"); return; }
            userData = { id, name };
            document.getElementById('start-container').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            showQuestion();
        }

        function showQuestion() {
            canAnswer = true;
            const q = quizData[currentQuestion];
            document.getElementById('question-number').innerText = `Q ${currentQuestion + 1} / ${quizData.length}`;
            document.getElementById('question-text').innerText = q.question;
            document.getElementById('progress-bar').style.width = `${(currentQuestion / quizData.length) * 100}%`;
            document.getElementById('feedback').classList.add('hidden');
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left p-4 border-2 border-gray-100 rounded-xl font-medium flex justify-between items-center group";
                btn.innerHTML = `<span>${opt}</span><span class="opacity-0 group-hover:opacity-100 transition dhl-red-text">âœ</span>`;
                btn.onclick = () => selectOption(idx, btn);
                container.appendChild(btn);
            });
        }

        function selectOption(idx, btn) {
            if (!canAnswer) return;
            canAnswer = false;
            const q = quizData[currentQuestion];
            
            if (idx === q.correct) {
                score += (100 / quizData.length);
                btn.classList.add('border-green-500', 'bg-green-50');
                showFeedback("Correct! âœ¨", "bg-green-500");
            } else {
                btn.classList.add('border-red-500', 'bg-red-50');
                showFeedback("Wrong!", "dhl-red-bg");
            }

            document.getElementById('score-display').innerText = `SCORE: ${Math.round(score)}`;
            
            setTimeout(() => {
                currentQuestion++;
                if (currentQuestion < quizData.length) showQuestion();
                else showResult();
            }, 800);
        }

        function showFeedback(text, cls) {
            const fb = document.getElementById('feedback');
            fb.innerText = text; fb.className = `p-4 text-center font-bold text-white ${cls}`;
            fb.classList.remove('hidden');
        }

        function showResult() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('result-container').classList.remove('hidden');
            document.getElementById('display-user-info').innerText = `${userData.name} (${userData.id})`;
            
            const finalScoreVal = Math.round(score);
            document.getElementById('final-score').innerText = finalScoreVal;

            const submitBtnText = document.getElementById('submit-btn-text');
            const resultEmoji = document.getElementById('result-emoji');
            const resultTitle = document.getElementById('result-title');

            if (finalScoreVal === 100) {
                submitBtnText.innerText = "æäº¤ä¸¦åƒåŠ æŠ½ç";
                resultEmoji.innerText = "ğŸ†";
                resultTitle.innerText = "æŒ‘æˆ°å®Œæˆï¼æ­å–œæ»¿åˆ†";
                
                // è§¸ç™¼å™´å½©å¸¶ç‰¹æ•ˆ
                triggerConfetti();
            } else {
                submitBtnText.innerText = "æäº¤ä¸¦é‡æ–°æŒ‘æˆ°";
                resultEmoji.innerText = "ğŸ’ª";
                resultTitle.innerText = "æŒ‘æˆ°å®Œæˆï¼å†æ¥å†å²";
            }
        }

        function triggerConfetti() {
            const duration = 3 * 1000;
            const end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: 3,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#FFCC00', '#D40511']
                });
                confetti({
                    particleCount: 3,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#FFCC00', '#D40511']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }

        async function submitToSheet() {
            const btn = document.getElementById('submit-btn');
            const loader = document.getElementById('submit-loader');
            const finalScoreVal = Math.round(score);
            
            btn.disabled = true;
            loader.classList.remove('hidden');

            try {
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: userData.id,
                        name: userData.name,
                        score: finalScoreVal
                    })
                });

                setTimeout(() => {
                    const overlayIcon = document.getElementById('overlay-icon');
                    const overlayTitle = document.getElementById('overlay-title');
                    const overlayMsg = document.getElementById('overlay-msg');
                    const overlayBtn = document.getElementById('overlay-btn');

                    if (finalScoreVal === 100) {
                        overlayIcon.innerText = "âœ…";
                        overlayTitle.innerText = "æäº¤æˆåŠŸï¼";
                        overlayMsg.innerText = "æ„Ÿè¬æ‚¨çš„åƒèˆ‡ï¼Œç¥æ‚¨ä¸­å¤§çï¼";
                        overlayBtn.innerText = "è¿”å›é¦–é ";
                    } else {
                        overlayIcon.innerText = "ğŸ“";
                        overlayTitle.innerText = "ç´€éŒ„å·²å„²å­˜";
                        overlayMsg.innerText = "æœªé” 100 åˆ†ç„¡æ³•åƒåŠ æŠ½çï¼Œè«‹é‡æ–°æŒ‘æˆ°ï¼";
                        overlayBtn.innerText = "é»é¸ä»¥é‡æ–°æŒ‘æˆ°";
                    }

                    document.getElementById('success-overlay').style.display = 'flex';
                    btn.disabled = false;
                    loader.classList.add('hidden');
                }, 1000);

            } catch (e) {
                console.error("Submit Error:", e);
                alert("æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚");
                btn.disabled = false;
                loader.classList.add('hidden');
            }
        }
    </script>
</body>
</html>